<!DOCTYPE html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Navigate your way trough EE via Tests</title><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.css"><link rel="stylesheet" href="/stylesheets/foundation-icons.css"><link rel="stylesheet" href="/stylesheets/app.css"><script src="/javascripts/vendor/custom.modernizr.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="author" type="text/plain" href="/humans.txt"></head><body class="antialiased"><nav class="top-bar"><ul class="title-area"><li class="name"><h1><a href="/">JavaEE Samples</a></h1></li><li class="toggle-topbar"><a href="#"><i class="fi-home"></i></a></li></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="/contributors">Contributors</a></li></li></ul></section></nav><div class="container"><header><div class="row"><div class="large-8 columns"><h2>Basic authentication<small></small></h2></div><div class="large-2 columns"><div class="howto right"><a class="button radius round" data-reveal-id="run">Run <i class="fi-play"></i></a><div id="run" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to run the sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jaspic/basic-authentication/">javaee7-samples</a><i class="fi-social-github"></i>GitHub repository. The first thing we need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="prettyprint"><code class="prettyprint">git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jaspic/basic-authentication/</code></pre>Now we are ready to start testing. You can run all the tests in this sample by executing:<pre class="prettyprint"><code class="prettyprint">mvn test</code></pre>Or you can run individual tests by executing one of the following:<pre class="prettyprint"><code class="prettyprint">mvn test -Dtest=BasicAuthenticationStatelessTestmvn test -Dtest=BasicAuthenticationPublicTestmvn test -Dtest=BasicAuthenticationProtectedTest</code></pre></hr></div></div></div></div><div class="sub"><div class="row"><div class="large-12 columns"><ul class="inline-list right"><li>Specifications in use</li><li><ul class="inline-list"></ul><li><a href="/#JASPIC">JASPIC</a></li><li><a href="/#Servlet">Servlet</a></li></li></ul></div></div></div><script type="text/javascript">//$(function() { activateGuideMenuControl() })</script></header><div class="row"><div class="large-12 columns"><div id="test"><h4>BasicAuthenticationStatelessTest</h4><div class="improve">Missing a description for the story. Add some javadoc to the TestClass. <a class="right" data-reveal-id="improve">Show me how!</a></div><div class="improve">Missing a description for the deployment. Add some javadoc to the @Deployment method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Deployment(testable = false)
public static WebArchive createDeployment() {
    return defaultArchive();
}</code></pre>Tests that access to a protected page does not depend on the authenticated identity that was established in a previous
 request.<pre class="prettyprint"><code class="prettyprint">@Test
public void testProtectedAccessIsStateless() throws IOException, SAXException {
    WebConversation conversion = new WebConversation();
    // -------------------- Request 1 ---------------------------
    // Accessing protected page without login
    WebResponse response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet"));
    // Not logged-in thus should not be accessible.
    assertFalse(response.getText().contains("This is a protected servlet"));
    // -------------------- Request 2 ---------------------------
    // JASPIC is stateless and login (re-authenticate) has to happen for every request
    //
    // If the following fails but "testProtectedPageLoggedin" has succeeded,
    // the container has probably remembered the "unauthenticated identity", e.g. it has remembered that
    // we're not authenticated and it will deny further attempts to authenticate. This may happen when
    // the container does not correctly recognize the JASPIC protocol for "do nothing".
    response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet?doLogin"));
    // Now has to be logged-in so page is accessible
    assertTrue("Could not access protected page, but should be able to. "
            + "Did the container remember the previously set 'unauthenticated identity'?",
            response.getText().contains("This is a protected servlet"));
    // -------------------- Request 3 ---------------------------
    // JASPIC is stateless and login (re-authenticate) has to happen for every request
    //
    // In the following method we do a call without logging in after one where we did login.
    // The container should not remember this login and has to deny access.
    response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet"));
    // Not logged-in thus should not be accessible.
    assertFalse("Could access protected page, but should not be able to. "
            + "Did the container remember the authenticated identity that was set in previous request?", response.getText()
            .contains("This is a protected servlet"));
}</code></pre>Tests that access to a protected page does not depend on the authenticated identity that was established in a previous
 request, but use a different request order than the previous test.<pre class="prettyprint"><code class="prettyprint">@Test
public void testProtectedAccessIsStateless2() throws IOException, SAXException {
    WebConversation conversion = new WebConversation();
    // -------------------- Request 1 ---------------------------
    // Start with doing a login
    WebResponse response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet?doLogin"));
    // -------------------- Request 2 ---------------------------
    // JASPIC is stateless and login (re-authenticate) has to happen for every request
    //
    // In the following method we do a call without logging in after one where we did login.
    // The container should not remember this login and has to deny access.
    // Accessing protected page without login
    response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet"));
    // Not logged-in thus should not be accessible.
    assertFalse("Could access protected page, but should not be able to. "
            + "Did the container remember the authenticated identity that was set in previous request?", response.getText()
            .contains("This is page A."));
}</code></pre>Tests independently from being able to access a protected resource if any details of a previously established
 authenticated identity are remembered<pre class="prettyprint"><code class="prettyprint">@Test
public void testUserIdentityIsStateless() throws IOException, SAXException {
    WebConversation conversion = new WebConversation();
    // -------------------- Request 1 ---------------------------
    // Accessing protected page with login
    WebResponse response = conversion.getResponse(new GetMethodWebRequest(base + "protected/servlet?doLogin"));
    // -------------------- Request 2 ---------------------------
    // Accessing public page without login
    response = conversion.getResponse(new GetMethodWebRequest(base + "public/servlet"));
    // No details should linger around
    assertFalse("User principal was 'test', but it should be null here. "
            + "The container seemed to have remembered it from the previous request.",
            response.getText().contains("web username: test"));
    assertTrue("User principal was not null, but it should be null here. ",
            response.getText().contains("web username: null"));
    assertTrue("The unauthenticated user has the role 'architect', which should not be the case. "
            + "The container seemed to have remembered it from the previous request.",
            response.getText().contains("web user has role \"architect\": false"));
}</code></pre></div><div id="test"><h4>BasicAuthenticationPublicTest</h4>This tests that we can login from a public page (a page for which no security constraints have been set).<div class="improve">Missing a description for the deployment. Add some javadoc to the @Deployment method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Deployment(testable = false)
public static WebArchive createDeployment() {
    return defaultArchive();
}</code></pre><div class="improve">Missing a description for the test scenario. Add some javadoc to the @Test method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Test
public void testPublicPageNotLoggedin() throws IOException, SAXException {
    WebResponse response = new WebConversation().getResponse(new GetMethodWebRequest(base + "public/servlet"));
    // Not logged-in
    assertTrue(response.getText().contains("web username: null"));
    assertTrue(response.getText().contains("web user has role \"architect\": false"));
}</code></pre><div class="improve">Missing a description for the test scenario. Add some javadoc to the @Test method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Test
public void testPublicPageLoggedin() throws IOException, SAXException {
    // JASPIC has to be able to authenticate a user when accessing a public (non-protected) resource.
    WebResponse response = new WebConversation().getResponse(new GetMethodWebRequest(base + "public/servlet?doLogin"));
    // Now has to be logged-in
    assertTrue(response.getText().contains("web username: test"));
    assertTrue(response.getText().contains("web user has role \"architect\": true"));
}</code></pre><div class="improve">Missing a description for the test scenario. Add some javadoc to the @Test method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Test
public void testPublicPageNotRememberLogin() throws IOException, SAXException {
    WebConversation conversion = new WebConversation();
    // -------------------- Request 1 ---------------------------
    WebResponse response = conversion.getResponse(new GetMethodWebRequest(base + "public/servlet"));
    // Not logged-in
    assertTrue(response.getText().contains("web username: null"));
    assertTrue(response.getText().contains("web user has role \"architect\": false"));
    System.out.println(response.getHeaderField("cookie"));
    // -------------------- Request 2 ---------------------------
    response = new WebConversation().getResponse(new GetMethodWebRequest(base + "public/servlet?doLogin"));
    // Now has to be logged-in
    assertTrue(response.getText().contains("web username: test"));
    assertTrue(response.getText().contains("web user has role \"architect\": true"));
    // -------------------- Request 3 ---------------------------
    response = conversion.getResponse(new GetMethodWebRequest(base + "public/servlet"));
    // Not logged-in
    assertTrue(response.getText().contains("web username: null"));
    assertTrue(response.getText().contains("web user has role \"architect\": false"));
}</code></pre></div><div id="test"><h4>BasicAuthenticationProtectedTest</h4>This tests that we can login from a protected resource (a resource for which security constraints have been set) and then
 access it.<div class="improve">Missing a description for the deployment. Add some javadoc to the @Deployment method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Deployment(testable = false)
public static WebArchive createDeployment() {
    return defaultArchive();
}</code></pre><div class="improve">Missing a description for the test scenario. Add some javadoc to the @Test method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Test
public void testProtectedPageNotLoggedin() throws IOException, SAXException {
    WebResponse getResponse = new WebConversation().getResponse(new GetMethodWebRequest(base + "protected/servlet"));
    // Not logged-in thus should not be accessible.
    assertFalse(getResponse.getText().contains("This is a protected servlet"));
}</code></pre><div class="improve">Missing a description for the test scenario. Add some javadoc to the @Test method. <a class="right" data-reveal-id="improve">Show me how!</a></div><pre class="prettyprint"><code class="prettyprint">@Test
public void testProtectedPageLoggedin() throws IOException, SAXException {
    WebResponse getResponse = new WebConversation().getResponse(new GetMethodWebRequest(base
            + "protected/servlet?doLogin=true"));
    // Now has to be logged-in so page is accessible
    assertTrue(getResponse.getText().contains("This is a protected servlet"));
}</code></pre></div><script type="text/javascript">$(function() {
  prettyPrint();
})</script></div></div><div id="improve" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to help improve this sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jaspic/basic-authentication/">javaee7-samples</a><i class="fi-social-github"></i>GitHub repository. The first thing you need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="prettyprint"><code class="prettyprint">git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jaspic/basic-authentication/</code></pre><p>Do the changes as you see fit and send a pull request!</p><p>Good Luck!</p></hr></div></div><footer class="row" style="max-width: 100%"><div class="large-6 columns" style="margin-bottom: .75em; margin-top: .75em"><ul class="unstyled"><li>&#169; Copyright 2013-2014 JavaEE Samples.</li><li><i class="fi-like"></i>&nbsp;Mixed with <a href="http://twitter.github.com/bootstrap">Bootstrap</a>. Baked by <a href="|http://awestruct.org">Awestruct</a>.</li><li><i class="fi-share"></i>&nbsp;Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</li><li>Code released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>.</li></ul></div></footer><script src="/javascripts/foundation/foundation.js"></script><script src="/javascripts/foundation/foundation.topbar.js"></script><script src="/javascripts/foundation/foundation.reveal.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script><script type="text/javascript">$(document).foundation()</script></body>